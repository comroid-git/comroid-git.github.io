<script type="application/javascript" when="isValidSession && (sessionData['account']['permit'] & 4) != 0">
    const table = document.getElementById('serviceTable');

    function injectServices(table, services) {
        services.forEach(serviceId => {
            let serviceRow = document.createElement('tr');
            let serviceIdBox = document.createElement('td');
            let serviceNameBox = document.createElement('td');

            serviceIdBox.textContent = serviceId;
            serviceIdBox.setAttribute('inject', `adminData.service.${serviceId}.id`)
            serviceNameBox.setAttribute('inject', `adminData.service.${serviceId}.name`)

            console.debug('appending children to table for', service['name']);
            serviceRow.append(serviceIdBox, serviceNameBox);
            table.append(serviceRow);
        })
    }

    function listServicesEvent(services) {
        // inject list of services to table
        console.debug('injecting services:', services.length);
        injectServices(table, services);
    }

    function reload() {
        console.info('Reloading Service Utilities')
        sendCommand('admin/listServices');
    }

    function initialize() {
        console.info('Initializing Service Utilities')

        // event listeners
        document.addEventListener('listServices', e => listServicesEvent(e.detail['services']));
        document.addEventListener('webkit/refresh', reload);

        // initiate
        reload();
    }

    document.addEventListener('frameReady', initialize)
</script>