<script type="application/javascript" when="isValidSession && (sessionData['account']['permit'] & 4) != 0">
    const table = document.getElementById('serviceTable');

    function injectServices(table, services) {
        services.forEach(service => {
            let serviceRow = document.createElement('tr');
            let serviceIdBox = document.createElement('td');
            let serviceNameBox = document.createElement('td');

            serviceIdBox.textContent = service['uuid'];
            serviceNameBox.textContent = service['name'];

            console.debug('appending children to table for', service['name']);
            serviceRow.append(serviceIdBox, serviceNameBox);
            table.append(serviceRow);
        })
    }

    function handleCustomEvent(type, data) {
        console.log("custom event", type, data);

        switch (type) {
            case 'listServices':

                break;
            default:
                console.log("Unknown Service event: ", type, data);
                break;
        }
    }

    function listServicesEvent(services) {
        // inject list of services to table
        console.debug('injecting services:', services.length);
        injectServices(table, services);
    }

    document.addEventListener('frameReady', e => {
        console.debug('initializing services')

        // event listeners
        document.addEventListener('listServices', e => listServicesEvent(e.detail['services']));

        // initiate
        sendCommand('admin/listServices');
    })
</script>